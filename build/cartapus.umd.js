!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).cartapus=t()}(this,function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function t(t,r){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return e(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,void 0):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}function r(){}r.prototype={on:function(e,t,r){var n=this.e||(this.e={});return(n[e]||(n[e]=[])).push({fn:t,ctx:r}),this},once:function(e,t,r){var n=this;function o(){n.off(e,o),t.apply(r,arguments)}return o._=t,this.on(e,o,r)},emit:function(e){for(var t=[].slice.call(arguments,1),r=((this.e||(this.e={}))[e]||[]).slice(),n=0,o=r.length;n<o;n++)r[n].fn.apply(r[n].ctx,t);return this},off:function(e,t){var r=this.e||(this.e={}),n=r[e],o=[];if(n&&t)for(var s=0,i=n.length;s<i;s++)n[s].fn!==t&&n[s].fn._!==t&&o.push(n[s]);return o.length?r[e]=o:delete r[e],this}};var n=r;return n.TinyEmitter=r,function(e){var r,n;function o(t){var r;return void 0===t&&(t={}),(r=e.call(this)||this).intersect=r.intersect.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r.options=Object.assign({root:null,rootMargin:"0px",threshold:.2,once:!1,events:!1},t),r.createMainObserver(),r.init(),r}n=e,(r=o).prototype=Object.create(n.prototype),r.prototype.constructor=r,r.__proto__=n;var s=o.prototype;return s.createMainObserver=function(){this.observers=[{observer:new IntersectionObserver(this.intersect,this.options),threshold:this.options.threshold,elements:[]}]},s.init=function(){this.getElems(),this.createObservers(),this.observe()},s.getElems=function(){this.elems=this.options.root?this.options.root.querySelectorAll("[data-cartapus]"):document.querySelectorAll("[data-cartapus]")},s.createObservers=function(){for(var e,r=t(this.elems);!(e=r()).done;){var n=e.value;if(n.dataset.cartapusThreshold){for(var o,s=parseFloat(n.dataset.cartapusThreshold),i=!1,a=t(this.observers);!(o=a()).done;){var c=o.value;s===c.threshold&&(i=!0,c.elements.push(n))}if(!i){var u={observer:new IntersectionObserver(this.intersect,Object.assign(this.options,{threshold:s})),threshold:s,elements:[n]};this.observers.push(u)}}else this.observers[0].elements.push(n)}},s.intersect=function(e,t){var r=this;e.forEach(function(e){e.isIntersecting?(e.target.dataset.cartapus="visible",r.options.once&&"false"!==e.target.dataset.cartapusOnce&&t.unobserve(e.target)):e.target.dataset.cartapus="hidden",r.options.events&&r.dispatch(e)})},s.dispatch=function(e){var t={element:e.target,visible:e.isIntersecting,intersection:e},r=new CustomEvent("cartapusintersect",{detail:t});e.target.dispatchEvent(r),this.emit("intersect",t)},s.observe=function(){this.observers.forEach(function(e){e.elements.forEach(function(t){e.observer.observe(t)})})},s.unobserve=function(){this.observers.forEach(function(e){e.elements.forEach(function(t){e.observer.unobserve(t)})})},s.destroy=function(){this.unobserve(),this.observers.forEach(function(e){e.elements=[]})},s.reset=function(){this.destroy(),this.init()},o}(n)});
//# sourceMappingURL=cartapus.umd.js.map
